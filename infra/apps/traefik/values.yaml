# infra/apps/traefik/values.yaml
# Base values for Traefik v3.x - environment-specific values will override these


global:
  domain: "{{ .Values.network.domain | default \"example.com\" }}"

providers:
  kubernetesCRD:
    allowCrossNamespace: true        # For centralized middleware
  kubernetesIngress:
    enabled: true
    publishedService:
      enabled: true


ingressRoute:
  dashboard:
    enabled: true
    entryPoints: ["websecure"]
    # Domain will be injected from environment layer
    matchRule: >
      Host(`traefik.{{ .Values.network.domain | default "example.com" }}`)
      && (PathPrefix(`/dashboard`) || PathPrefix(`/api`))
    middlewares:
      - name: basic-auth
        namespace: admin

ports:
  web:
    redirections:
      entryPoint:
        to: websecure
        scheme: https
        permanent: true

service:
  type: LoadBalancer

persistence:
  enabled: false
  path: /data
  size: 128Mi
