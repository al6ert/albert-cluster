# infra/apps/traefik/values.yaml
# Valores base para Traefik v3.x

global:
  domain: "example.com"

service:
  type: LoadBalancer

ports:
  web:
    port: 80
    expose:
      enabled: true
      exposedPort: 80
      protocol: TCP
  websecure:
    port: 443
    expose:
      enabled: true
      exposedPort: 443
      protocol: TCP
  metrics:
    port: 9100
    expose:
      enabled: true
      exposedPort: 9100
      protocol: TCP

persistence:
  enabled: false
  path: /data
  size: 128Mi

additionalArguments:
  - "--certificatesresolvers.le.acme.httpchallenge=true"
  - "--certificatesresolvers.le.acme.httpchallenge.entrypoint=web"
  - "--certificatesresolvers.le.acme.email=albert@albertperez.dev"
  - "--certificatesresolvers.le.acme.storage=/data/acme.json"
  - "--certificatesresolvers.le.acme.caserver=https://acme-staging-v02.api.letsencrypt.org/directory"

ingressRoute:
  dashboard:
    enabled: true
    annotations:
      kubernetes.io/ingress.class: traefik
    entryPoints: ["web", "websecure"]
    matchRule: >
      Host(`traefik.{{ .Values.global.domain }}`)
      && (PathPrefix(`/dashboard`) || PathPrefix(`/api`)) 