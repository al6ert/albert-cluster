# infra/apps/traefik/values.yaml
# Valores base para Traefik v3.x

##########################
# CONFIGURACIÓN GLOBAL
##########################
global:
  domain: "example.com"

providers:
  kubernetesCRD:
    allowCrossNamespace: true        # Para middleware centralizado

##########################
# DASHBOARD
##########################
ingressRoute:
  dashboard:
    enabled: true
    entryPoints: ["websecure"]
    # Dominio se inyectará desde la capa env
    matchRule: >
      Host(`traefik.example.com`)
      && (PathPrefix(`/dashboard`) || PathPrefix(`/api`))
    middlewares:
      - name: basic-auth
        namespace: admin
    tls:
      # secretName viene por overlay; aquí un placeholder
      secretName: ""

##########################
# OBJETOS EXTRA (Middleware)
##########################
extraObjects:
  - apiVersion: traefik.io/v1alpha1
    kind: Middleware
    metadata:
      name: basic-auth
      namespace: admin
    spec:
      basicAuth:
        secret: admin-basic-auth
        realm: "Protected Area"

##########################
# CONFIGURACIÓN DE SERVICIOS
##########################
service:
  type: LoadBalancer

ports:
  web:
    port: 80
    expose:
      enabled: true
      exposedPort: 80
      protocol: TCP
  websecure:
    port: 443
    expose:
      enabled: true
      exposedPort: 443
      protocol: TCP
  metrics:
    port: 9100
    expose:
      enabled: true
      exposedPort: 9100
      protocol: TCP

persistence:
  enabled: false
  path: /data
  size: 128Mi

additionalArguments:
  - "--certificatesresolvers.le.acme.httpchallenge=true"
  - "--certificatesresolvers.le.acme.httpchallenge.entrypoint=web"
  - "--certificatesresolvers.le.acme.email=albert@albertperez.dev"
  - "--certificatesresolvers.le.acme.storage=/data/acme.json"
  - "--certificatesresolvers.le.acme.caserver=https://acme-staging-v02.api.letsencrypt.org/directory" 